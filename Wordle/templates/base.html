<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wordle</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    
    <div class="wordle">
        <div class="game">
            {% for color_row in colors %}
                {% set rowloop = loop.index0 %}
                {% for color in color_row %}
                    {% if rowloop == guess_no and not won%}
                        <input type="text" name="guess_letter" id="{{loop.index0}}" autocomplete="off" autocapitalize="on" maxlength="1" onkeydown="key_check(event, this.id)" onchange="next_box(this.id)">
                    {% else %}
                        <square correct='{{color}}'>{{words[rowloop][loop.index0]}}</square> 
                    {% endif %}

                {% endfor %}
            {% endfor %}
            
        </div>
        <div class="letters">
            {% for letter in letter_list %}
                {% if letter in "az"%}
                    <br>
                {% endif %}
                
                {% if letter in green_list %}
                    <div guessed="green">
                {% elif letter in yellow_list %}
                    <div guessed="yellow">
                {% elif letter in gray_list %}
                    <div guessed="gray">
                {% else %}
                    <div>
                {% endif %}
                {{letter}}</div>
            {% endfor %}
        </div>
    </div>
    <br> {{ output }}
    
    <form name="simple_input" action="" method="get">
        <input type="textarea" name="guess" autocomplete="off" autocapitalize="on" maxlength="5" hidden="on">
        

    </form>

    <form action = "reset" method="get">
        <input type="submit" value="Reset" name="reset">
    </form>

<script type="text/javascript">
    function combined_submit()
    {
        console.log("Combo Submit");
        //let temp = document.getElementById("combo");
        let boxes = document.getElementsByName("guess_letter");
        var text = "";
        for(elem of boxes)
            text += elem.value
        console.log(text);

        var temp = document.forms["simple_input"];
        console.log(temp);
        temp["guess"].value = text;
        //var temp = document.createElement("FORM");
        //temp.name = "test";
        
        temp.submit();
    }
    function key_check(event, current_id)
    {
        event.preventDefault();
        console.log("Current Box" + current_id);
        let key_val = document.getElementById(current_id).value;
        if(event.key=="Backspace")
        {
            if (key_val=="")
            {
                let box = document.getElementById(current_id-1);
                box.value = "";
                box.focus();
            }
            else
                document.getElementById(current_id).value = "";  
            
        }
        else if(event.key=="Enter")
            combined_submit();
        else if(event.key =="Tab")
            if (!event.shiftKey)
                document.getElementById(parseInt(current_id)+1).focus();
            else
                document.getElementById(parseInt(current_id)-1).focus();
        else if(event.key.length==1 && event.key != "Space")
        {
            console.log("Key: " + event.key);
            document.getElementById(current_id).value=event.key;
            let temp = document.getElementById(parseInt(current_id)+1);
            console.log("New Index: " + parseInt(current_id)+1)
            temp.focus();
        }
   
            
    }
    function next_box(id)
    {
        console.log("Current Box" + id);
        for (let index = id; index < 5; index++) 
        {
            let temp = document.getElementById(index);
            if(temp.value == "")
            {
                temp.focus();
                break;
            }
        }
        

    }

</script>

</body>


</html>